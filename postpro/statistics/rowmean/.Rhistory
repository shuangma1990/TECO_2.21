errvalue<-as.vector(annsdplt[rowcutter,c])
# ************************************************
ms = data.frame(x = x, y = y, sd = errvalue)
# plot(x,y,col=caf,lwd=3 ,pch=16, cex=pointcex, ylim=c(0,1000), xlim=xrg,main=NA, axes=F, ann=F)
plot(x,y,col=caf,lwd=3 ,pch=16, cex=pointcex, xlim=xrg,ylim = range(min(y)*0.5,max(y)*1.5),
main=NA,ylab = colnames(annplt[c]))
par(fg = cabar)
with(data = ms, expr = errbar(x,y,y+sd,y-sd,add=T,pch=16,cap=.01,col=caf))
# axis(side=2, labels=T, tck=0.03, las=1,mgp=c(3, 0.3,0), at=c(seq(from=0,to=400,by=50)))
par(fg = "black")
fit <- lm(y~ x)
summary(fit)$r.squared
pvalue <- summary(fit)$coefficients[2,4]
#-----  OLS  ----------------------------------------------------------------
x0 <- seq(min(x), max(x), length = 20)  ## prediction grid
y0 <- predict.lm(fit, newdata = list(x = x0))  ## predicted values
slp1=round(as.numeric(fit$coefficients[2]),digit=1)
if (pvalue<0.05){
lines(x0, y0, col = 'red',lwd=3)  ## add regression curve (colour: red)
mtext(paste('Slope = ',slp1,sep=''),outer=FALSE,side=3,line = -4.,col = "red",
at=par("usr")[1]+0.2*diff(par("usr")[1:2]),cex=rsize)
}
#-----  TLS   ---------------------------------------------------------------
v <- prcomp(cbind(x,y))$rotation
beta <- v[2,1]/v[1,1]
inter <- mean(y) - beta*mean(x)
x00 <- seq(min(x), max(x), length = 20)
y00 <- beta*x00+inter
if (pvalue<0.05){
lines(x00,y00,col="blue",lwd=2)
}
slp2 <- round(beta,digits = 2)
# saveslp <- cbind(saveslp,slp2)
#----------------------------------------------------------------------------
a=round(cor(x,y),digits = 2)
# b=round(RMSE(x,y),digits = 2)
mtext(paste('R = ',a,sep=''),outer=FALSE,side=1,line = -3.,col = "black",
at=par("usr")[1]+0.8*diff(par("usr")[1:2]),cex=rsize)
if ((pvalue<0.05) & (pvalue>0.01)){
mtext(paste('P < 0.05 ',sep=''),outer=FALSE,side=1,line = -2.,col = "black",
at=par("usr")[1]+0.8*diff(par("usr")[1:2]),cex=rsize)
mtext(paste('Slope = ',slp2,sep=''),outer=FALSE,side=3,line = -8.,col = "blue",
at=par("usr")[1]+0.2*diff(par("usr")[1:2]),cex=rsize)
}else if(pvalue<=0.01){
mtext(paste('P < 0.01',sep=''),outer=FALSE,side=1,line = -2.,col = "black",
at=par("usr")[1]+0.8*diff(par("usr")[1:2]),cex=rsize)
mtext(paste('Slope = ',slp2,sep=''),outer=FALSE,side=3,line = -8.,col = "blue",
at=par("usr")[1]+0.2*diff(par("usr")[1:2]),cex=rsize)
}
mtext(paste('(',c-1,')',sep=''),outer=FALSE,side=1,line = -5.,col = "black",
at=par("usr")[1]+0.9*diff(par("usr")[1:2]),cex=rsize)
}
a=c("f1p1","f1p2","f1p3","f1p4","f1p5","f1p6")
CS<-c('_MCMC_CS1722','_MCMC_CS1722','_MCMC_CS1422','_MCMC_CS1722','_MCMC_CS1422','_MCMC_CS1622')
moy <- rep(c(1:12),8)
year<- rep(c(2011:2018),each=12)
annplt <- matrix(NA,ncol = 38,nrow = 48)
annsdplt<- matrix(NA,ncol = 38,nrow = 48)
for(i in 1:6){
# i=1
setwd("~/RESEARCH/TECO_SPRUCE_site/TECO_2.21_Dissertation/jpl_server/TECO_2.21/postpro/statistics/rowmean/")
df1 <- read.csv(paste('rowmean',CS[i],'_',a[i],'.csv',sep=''),header = T)
df2 <- read.csv(paste('rowsd',CS[i],'_',a[i],'.csv',sep=''),header = T)
df1 <- cbind(year,moy,df1)
df2 <- cbind(year,moy,df2)
df11 <- aggregate(df1[,c(18:25,32:41)],by=list(df1$year),FUN=mean)
df12 <- aggregate(df1[,c(4:17,26:31)],by=list(df1$year),FUN=sum)
df21 <- aggregate(df2[,c(18:25,32:41)],by=list(df2$year),FUN=mean)
df22 <- aggregate(df2[,c(4:17,26:31)],by=list(df2$year),FUN=sum)
ann <- cbind(df11[,-1],df12[,-1])
annsd<-cbind(df21[,-1],df22[,-1])
if (i==1){
annplt <- ann
annsdplt<-annsd
}else{
annplt <- rbind(annplt,ann)
annsdplt<-rbind(annsdplt,annsd)
}
}
rowcutter <- c(6:8,14:16,22:24,30:32,38:40,46:48)
setwd("~/RESEARCH/TECO_SPRUCE_site/TECO_2.21_Dissertation/jpl_server/TECO_2.21/postpro/statistics/rowmean/")
pdf(paste("figure.pdf",sep=''),width=7.5, height=3.75, compress=FALSE)
par(mfrow=c(2,3),oma=c(3, 0, 0, 1))
par(cex.lab=1.2)
caf="forest green"
cab="#999999"
cabar="forest green"
pointcex=1
xrg=c(0,20)  # year round mean
xat=c(0,5,10,15,20)
xairseq = seq(0,20,0.01)
xsoilseq = seq(0,20,0.01)
m_at = 15
xsoil = xair
rsize=1
# xrg=c(10,35)   # growing season mean
# xat=c(10,15,20,25,30,35)
# xairseq = seq(10,35,0.01)
# xsoilseq = seq(10,35,0.01)
# m_at = 30
par(mfrow=c(3,4),oma=c(2, 0, 0, 1))
for (c in c(1:8,19:38)){
# c=1
op <- par(mar=c(0.5, 5.25, 1, 0))
x <- xair
y <- as.vector(annplt[rowcutter,c])
errvalue<-as.vector(annsdplt[rowcutter,c])
# ************************************************
ms = data.frame(x = x, y = y, sd = errvalue)
# plot(x,y,col=caf,lwd=3 ,pch=16, cex=pointcex, ylim=c(0,1000), xlim=xrg,main=NA, axes=F, ann=F)
plot(x,y,col=caf,lwd=3 ,pch=16, cex=pointcex, xlim=xrg,ylim = range(min(y)*0.5,max(y)*1.5),
main=NA,ylab = colnames(annplt[c]))
par(fg = cabar)
with(data = ms, expr = errbar(x,y,y+sd,y-sd,add=T,pch=16,cap=.01,col=caf))
# axis(side=2, labels=T, tck=0.03, las=1,mgp=c(3, 0.3,0), at=c(seq(from=0,to=400,by=50)))
par(fg = "black")
fit <- lm(y~ x)
summary(fit)$r.squared
pvalue <- summary(fit)$coefficients[2,4]
#-----  OLS  ----------------------------------------------------------------
x0 <- seq(min(x), max(x), length = 20)  ## prediction grid
y0 <- predict.lm(fit, newdata = list(x = x0))  ## predicted values
slp1=round(as.numeric(fit$coefficients[2]),digit=1)
if (pvalue<0.05){
lines(x0, y0, col = 'red',lwd=3)  ## add regression curve (colour: red)
mtext(paste('Slope = ',slp1,sep=''),outer=FALSE,side=3,line = -4.,col = "red",
at=par("usr")[1]+0.2*diff(par("usr")[1:2]),cex=rsize)
}
#-----  TLS   ---------------------------------------------------------------
v <- prcomp(cbind(x,y))$rotation
beta <- v[2,1]/v[1,1]
inter <- mean(y) - beta*mean(x)
x00 <- seq(min(x), max(x), length = 20)
y00 <- beta*x00+inter
if (pvalue<0.05){
lines(x00,y00,col="blue",lwd=2)
}
slp2 <- round(beta,digits = 2)
# saveslp <- cbind(saveslp,slp2)
#----------------------------------------------------------------------------
a=round(cor(x,y),digits = 2)
# b=round(RMSE(x,y),digits = 2)
mtext(paste('R = ',a,sep=''),outer=FALSE,side=1,line = -3.,col = "black",
at=par("usr")[1]+0.8*diff(par("usr")[1:2]),cex=rsize)
if ((pvalue<0.05) & (pvalue>0.01)){
mtext(paste('P < 0.05 ',sep=''),outer=FALSE,side=1,line = -2.,col = "black",
at=par("usr")[1]+0.8*diff(par("usr")[1:2]),cex=rsize)
mtext(paste('Slope = ',slp2,sep=''),outer=FALSE,side=3,line = -8.,col = "blue",
at=par("usr")[1]+0.2*diff(par("usr")[1:2]),cex=rsize)
}else if(pvalue<=0.01){
mtext(paste('P < 0.01',sep=''),outer=FALSE,side=1,line = -2.,col = "black",
at=par("usr")[1]+0.8*diff(par("usr")[1:2]),cex=rsize)
mtext(paste('Slope = ',slp2,sep=''),outer=FALSE,side=3,line = -8.,col = "blue",
at=par("usr")[1]+0.2*diff(par("usr")[1:2]),cex=rsize)
}
mtext(paste('(',c-1,')',sep=''),outer=FALSE,side=1,line = -5.,col = "black",
at=par("usr")[1]+0.9*diff(par("usr")[1:2]),cex=rsize)
}
dev.off()
# CO2.CH4=ann.er/ann.ch4
# Rh.ratio=ann.rh/ann.er
# oxipercentage=ann.oxid/ann.prod
# df <- rbind(CO2.CH4,Rh.ratio,ann.nee)
# print("save to csv file")
# # setwd("E:/Netbeans_Project/TECO_SPRUCE_2.2_acclimation_server/scripts_on_server/Rscript_on_server/ann/")
# setwd(paste(readpath,"ann/",sep=''))
# write.csv(df, file = paste("statistics/ann_yr_ratios",CS[1],".csv",sep=''))
a=c("f1p1","f1p2","f1p3","f1p4","f1p5","f1p6")
CS<-c('_MCMC_CS1722','_MCMC_CS1722','_MCMC_CS1422','_MCMC_CS1722','_MCMC_CS1422','_MCMC_CS1622')
moy <- rep(c(1:12),8)
year<- rep(c(2011:2018),each=12)
annplt <- matrix(NA,ncol = 38,nrow = 48)
annsdplt<- matrix(NA,ncol = 38,nrow = 48)
for(i in 1:6){
# i=1
setwd("~/RESEARCH/TECO_SPRUCE_site/TECO_2.21_Dissertation/jpl_server/TECO_2.21/postpro/statistics/rowmean/")
df1 <- read.csv(paste('rowmean',CS[i],'_',a[i],'.csv',sep=''),header = T)
df2 <- read.csv(paste('rowsd',CS[i],'_',a[i],'.csv',sep=''),header = T)
df1 <- cbind(year,moy,df1)
df2 <- cbind(year,moy,df2)
df11 <- aggregate(df1[,c(18:25,32:41)],by=list(df1$year),FUN=mean)
df12 <- aggregate(df1[,c(4:17,26:31)],by=list(df1$year),FUN=sum)
df21 <- aggregate(df2[,c(18:25,32:41)],by=list(df2$year),FUN=mean)
df22 <- aggregate(df2[,c(4:17,26:31)],by=list(df2$year),FUN=sum)
ann <- cbind(df11[,-1],df12[,-1])
annsd<-cbind(df21[,-1],df22[,-1])
if (i==1){
annplt <- ann
annsdplt<-annsd
}else{
annplt <- rbind(annplt,ann)
annsdplt<-rbind(annsdplt,annsd)
}
}
rowcutter <- c(6:8,14:16,22:24,30:32,38:40,46:48)
setwd("~/RESEARCH/TECO_SPRUCE_site/TECO_2.21_Dissertation/jpl_server/TECO_2.21/postpro/statistics/rowmean/")
pdf(paste("figure.pdf",sep=''),width=10.5, height=7.75, compress=FALSE)
par(mfrow=c(2,3),oma=c(3, 0, 0, 1))
par(cex.lab=1.2)
caf="forest green"
cab="#999999"
cabar="forest green"
pointcex=1
xrg=c(0,20)  # year round mean
xat=c(0,5,10,15,20)
xairseq = seq(0,20,0.01)
xsoilseq = seq(0,20,0.01)
m_at = 15
xsoil = xair
rsize=1
# xrg=c(10,35)   # growing season mean
# xat=c(10,15,20,25,30,35)
# xairseq = seq(10,35,0.01)
# xsoilseq = seq(10,35,0.01)
# m_at = 30
par(mfrow=c(3,4),oma=c(2, 0, 0, 1))
for (c in c(1:8,19:38)){
# c=1
op <- par(mar=c(0.5, 5.25, 1, 0))
x <- xair
y <- as.vector(annplt[rowcutter,c])
errvalue<-as.vector(annsdplt[rowcutter,c])
# ************************************************
ms = data.frame(x = x, y = y, sd = errvalue)
# plot(x,y,col=caf,lwd=3 ,pch=16, cex=pointcex, ylim=c(0,1000), xlim=xrg,main=NA, axes=F, ann=F)
plot(x,y,col=caf,lwd=3 ,pch=16, cex=pointcex, xlim=xrg,ylim = range(min(y)*0.5,max(y)*1.5),
main=NA,ylab = colnames(annplt[c]))
par(fg = cabar)
with(data = ms, expr = errbar(x,y,y+sd,y-sd,add=T,pch=16,cap=.01,col=caf))
# axis(side=2, labels=T, tck=0.03, las=1,mgp=c(3, 0.3,0), at=c(seq(from=0,to=400,by=50)))
par(fg = "black")
fit <- lm(y~ x)
summary(fit)$r.squared
pvalue <- summary(fit)$coefficients[2,4]
#-----  OLS  ----------------------------------------------------------------
x0 <- seq(min(x), max(x), length = 20)  ## prediction grid
y0 <- predict.lm(fit, newdata = list(x = x0))  ## predicted values
slp1=round(as.numeric(fit$coefficients[2]),digit=1)
if (pvalue<0.05){
lines(x0, y0, col = 'red',lwd=3)  ## add regression curve (colour: red)
mtext(paste('Slope = ',slp1,sep=''),outer=FALSE,side=3,line = -4.,col = "red",
at=par("usr")[1]+0.2*diff(par("usr")[1:2]),cex=rsize)
}
#-----  TLS   ---------------------------------------------------------------
v <- prcomp(cbind(x,y))$rotation
beta <- v[2,1]/v[1,1]
inter <- mean(y) - beta*mean(x)
x00 <- seq(min(x), max(x), length = 20)
y00 <- beta*x00+inter
if (pvalue<0.05){
lines(x00,y00,col="blue",lwd=2)
}
slp2 <- round(beta,digits = 2)
# saveslp <- cbind(saveslp,slp2)
#----------------------------------------------------------------------------
a=round(cor(x,y),digits = 2)
# b=round(RMSE(x,y),digits = 2)
mtext(paste('R = ',a,sep=''),outer=FALSE,side=1,line = -3.,col = "black",
at=par("usr")[1]+0.8*diff(par("usr")[1:2]),cex=rsize)
if ((pvalue<0.05) & (pvalue>0.01)){
mtext(paste('P < 0.05 ',sep=''),outer=FALSE,side=1,line = -2.,col = "black",
at=par("usr")[1]+0.8*diff(par("usr")[1:2]),cex=rsize)
mtext(paste('Slope = ',slp2,sep=''),outer=FALSE,side=3,line = -8.,col = "blue",
at=par("usr")[1]+0.2*diff(par("usr")[1:2]),cex=rsize)
}else if(pvalue<=0.01){
mtext(paste('P < 0.01',sep=''),outer=FALSE,side=1,line = -2.,col = "black",
at=par("usr")[1]+0.8*diff(par("usr")[1:2]),cex=rsize)
mtext(paste('Slope = ',slp2,sep=''),outer=FALSE,side=3,line = -8.,col = "blue",
at=par("usr")[1]+0.2*diff(par("usr")[1:2]),cex=rsize)
}
mtext(paste('(',c-1,')',sep=''),outer=FALSE,side=1,line = -5.,col = "black",
at=par("usr")[1]+0.9*diff(par("usr")[1:2]),cex=rsize)
}
dev.off()
# CO2.CH4=ann.er/ann.ch4
# Rh.ratio=ann.rh/ann.er
# oxipercentage=ann.oxid/ann.prod
# df <- rbind(CO2.CH4,Rh.ratio,ann.nee)
# print("save to csv file")
# # setwd("E:/Netbeans_Project/TECO_SPRUCE_2.2_acclimation_server/scripts_on_server/Rscript_on_server/ann/")
# setwd(paste(readpath,"ann/",sep=''))
# write.csv(df, file = paste("statistics/ann_yr_ratios",CS[1],".csv",sep=''))
a=c("f1p1","f1p2","f1p3","f1p4","f1p5","f1p6")
CS<-c('_MCMC_CS1722','_MCMC_CS1722','_MCMC_CS1422','_MCMC_CS1722','_MCMC_CS1422','_MCMC_CS1622')
moy <- rep(c(1:12),8)
year<- rep(c(2011:2018),each=12)
annplt <- matrix(NA,ncol = 38,nrow = 48)
annsdplt<- matrix(NA,ncol = 38,nrow = 48)
for(i in 1:6){
# i=1
setwd("~/RESEARCH/TECO_SPRUCE_site/TECO_2.21_Dissertation/jpl_server/TECO_2.21/postpro/statistics/rowmean/")
df1 <- read.csv(paste('rowmean',CS[i],'_',a[i],'.csv',sep=''),header = T)
df2 <- read.csv(paste('rowsd',CS[i],'_',a[i],'.csv',sep=''),header = T)
df1 <- cbind(year,moy,df1)
df2 <- cbind(year,moy,df2)
df11 <- aggregate(df1[,c(18:25,32:41)],by=list(df1$year),FUN=mean)
df12 <- aggregate(df1[,c(4:17,26:31)],by=list(df1$year),FUN=sum)
df21 <- aggregate(df2[,c(18:25,32:41)],by=list(df2$year),FUN=mean)
df22 <- aggregate(df2[,c(4:17,26:31)],by=list(df2$year),FUN=sum)
ann <- cbind(df11[,-1],df12[,-1])
annsd<-cbind(df21[,-1],df22[,-1])
if (i==1){
annplt <- ann
annsdplt<-annsd
}else{
annplt <- rbind(annplt,ann)
annsdplt<-rbind(annsdplt,annsd)
}
}
rowcutter <- c(6:8,14:16,22:24,30:32,38:40,46:48)
setwd("~/RESEARCH/TECO_SPRUCE_site/TECO_2.21_Dissertation/jpl_server/TECO_2.21/postpro/statistics/rowmean/")
pdf(paste("figure.pdf",sep=''),width=12.5, height=7.75, compress=FALSE)
par(mfrow=c(2,3),oma=c(3, 0, 0, 1))
par(cex.lab=1.2)
caf="forest green"
cab="#999999"
cabar="forest green"
pointcex=1
xrg=c(0,20)  # year round mean
xat=c(0,5,10,15,20)
xairseq = seq(0,20,0.01)
xsoilseq = seq(0,20,0.01)
m_at = 15
xsoil = xair
rsize=1
# xrg=c(10,35)   # growing season mean
# xat=c(10,15,20,25,30,35)
# xairseq = seq(10,35,0.01)
# xsoilseq = seq(10,35,0.01)
# m_at = 30
par(mfrow=c(3,4),oma=c(2, 0, 0, 1))
for (c in c(1:8,19:38)){
# c=1
op <- par(mar=c(0.5, 5.25, 1, 0))
x <- xair
y <- as.vector(annplt[rowcutter,c])
errvalue<-as.vector(annsdplt[rowcutter,c])
# ************************************************
ms = data.frame(x = x, y = y, sd = errvalue)
# plot(x,y,col=caf,lwd=3 ,pch=16, cex=pointcex, ylim=c(0,1000), xlim=xrg,main=NA, axes=F, ann=F)
plot(x,y,col=caf,lwd=3 ,pch=16, cex=pointcex, xlim=xrg,ylim = range(min(y)*0.5,max(y)*1.5),
main=NA,ylab = colnames(annplt[c]))
par(fg = cabar)
with(data = ms, expr = errbar(x,y,y+sd,y-sd,add=T,pch=16,cap=.01,col=caf))
# axis(side=2, labels=T, tck=0.03, las=1,mgp=c(3, 0.3,0), at=c(seq(from=0,to=400,by=50)))
par(fg = "black")
fit <- lm(y~ x)
summary(fit)$r.squared
pvalue <- summary(fit)$coefficients[2,4]
#-----  OLS  ----------------------------------------------------------------
x0 <- seq(min(x), max(x), length = 20)  ## prediction grid
y0 <- predict.lm(fit, newdata = list(x = x0))  ## predicted values
slp1=round(as.numeric(fit$coefficients[2]),digit=1)
if (pvalue<0.05){
lines(x0, y0, col = 'red',lwd=3)  ## add regression curve (colour: red)
mtext(paste('Slope = ',slp1,sep=''),outer=FALSE,side=3,line = -4.,col = "red",
at=par("usr")[1]+0.2*diff(par("usr")[1:2]),cex=rsize)
}
#-----  TLS   ---------------------------------------------------------------
v <- prcomp(cbind(x,y))$rotation
beta <- v[2,1]/v[1,1]
inter <- mean(y) - beta*mean(x)
x00 <- seq(min(x), max(x), length = 20)
y00 <- beta*x00+inter
if (pvalue<0.05){
lines(x00,y00,col="blue",lwd=2)
}
slp2 <- round(beta,digits = 2)
# saveslp <- cbind(saveslp,slp2)
#----------------------------------------------------------------------------
a=round(cor(x,y),digits = 2)
# b=round(RMSE(x,y),digits = 2)
mtext(paste('R = ',a,sep=''),outer=FALSE,side=1,line = -3.,col = "black",
at=par("usr")[1]+0.8*diff(par("usr")[1:2]),cex=rsize)
if ((pvalue<0.05) & (pvalue>0.01)){
mtext(paste('P < 0.05 ',sep=''),outer=FALSE,side=1,line = -2.,col = "black",
at=par("usr")[1]+0.8*diff(par("usr")[1:2]),cex=rsize)
mtext(paste('Slope = ',slp2,sep=''),outer=FALSE,side=3,line = -8.,col = "blue",
at=par("usr")[1]+0.2*diff(par("usr")[1:2]),cex=rsize)
}else if(pvalue<=0.01){
mtext(paste('P < 0.01',sep=''),outer=FALSE,side=1,line = -2.,col = "black",
at=par("usr")[1]+0.8*diff(par("usr")[1:2]),cex=rsize)
mtext(paste('Slope = ',slp2,sep=''),outer=FALSE,side=3,line = -8.,col = "blue",
at=par("usr")[1]+0.2*diff(par("usr")[1:2]),cex=rsize)
}
mtext(paste('(',c-1,')',sep=''),outer=FALSE,side=1,line = -5.,col = "black",
at=par("usr")[1]+0.9*diff(par("usr")[1:2]),cex=rsize)
}
dev.off()
# CO2.CH4=ann.er/ann.ch4
# Rh.ratio=ann.rh/ann.er
# oxipercentage=ann.oxid/ann.prod
# df <- rbind(CO2.CH4,Rh.ratio,ann.nee)
# print("save to csv file")
# # setwd("E:/Netbeans_Project/TECO_SPRUCE_2.2_acclimation_server/scripts_on_server/Rscript_on_server/ann/")
# setwd(paste(readpath,"ann/",sep=''))
# write.csv(df, file = paste("statistics/ann_yr_ratios",CS[1],".csv",sep=''))
a=c("f1p1","f1p2","f1p3","f1p4","f1p5","f1p6")
CS<-c('_MCMC_CS1722','_MCMC_CS1722','_MCMC_CS1422','_MCMC_CS1722','_MCMC_CS1422','_MCMC_CS1622')
moy <- rep(c(1:12),8)
year<- rep(c(2011:2018),each=12)
annplt <- matrix(NA,ncol = 38,nrow = 48)
annsdplt<- matrix(NA,ncol = 38,nrow = 48)
for(i in 1:6){
# i=1
setwd("~/RESEARCH/TECO_SPRUCE_site/TECO_2.21_Dissertation/jpl_server/TECO_2.21/postpro/statistics/rowmean/")
df1 <- read.csv(paste('rowmean',CS[i],'_',a[i],'.csv',sep=''),header = T)
df2 <- read.csv(paste('rowsd',CS[i],'_',a[i],'.csv',sep=''),header = T)
df1 <- cbind(year,moy,df1)
df2 <- cbind(year,moy,df2)
df11 <- aggregate(df1[,c(18:25,32:41)],by=list(df1$year),FUN=mean)
df12 <- aggregate(df1[,c(4:17,26:31)],by=list(df1$year),FUN=sum)
df21 <- aggregate(df2[,c(18:25,32:41)],by=list(df2$year),FUN=mean)
df22 <- aggregate(df2[,c(4:17,26:31)],by=list(df2$year),FUN=sum)
ann <- cbind(df11[,-1],df12[,-1])
annsd<-cbind(df21[,-1],df22[,-1])
if (i==1){
annplt <- ann
annsdplt<-annsd
}else{
annplt <- rbind(annplt,ann)
annsdplt<-rbind(annsdplt,annsd)
}
}
rowcutter <- c(6:8,14:16,22:24,30:32,38:40,46:48)
setwd("~/RESEARCH/TECO_SPRUCE_site/TECO_2.21_Dissertation/jpl_server/TECO_2.21/postpro/statistics/rowmean/")
pdf(paste("figure.pdf",sep=''),width=15.5, height=7.75, compress=FALSE)
par(mfrow=c(2,3),oma=c(3, 0, 0, 1))
par(cex.lab=1.2)
caf="forest green"
cab="#999999"
cabar="forest green"
pointcex=1
xrg=c(0,20)  # year round mean
xat=c(0,5,10,15,20)
xairseq = seq(0,20,0.01)
xsoilseq = seq(0,20,0.01)
m_at = 15
xsoil = xair
rsize=1
# xrg=c(10,35)   # growing season mean
# xat=c(10,15,20,25,30,35)
# xairseq = seq(10,35,0.01)
# xsoilseq = seq(10,35,0.01)
# m_at = 30
par(mfrow=c(3,4),oma=c(2, 0, 0, 1))
for (c in c(1:8,19:38)){
# c=1
op <- par(mar=c(0.5, 5.25, 1, 0))
x <- xair
y <- as.vector(annplt[rowcutter,c])
errvalue<-as.vector(annsdplt[rowcutter,c])
# ************************************************
ms = data.frame(x = x, y = y, sd = errvalue)
# plot(x,y,col=caf,lwd=3 ,pch=16, cex=pointcex, ylim=c(0,1000), xlim=xrg,main=NA, axes=F, ann=F)
plot(x,y,col=caf,lwd=3 ,pch=16, cex=pointcex, xlim=xrg,ylim = range(min(y)*0.5,max(y)*1.5),
main=NA,ylab = colnames(annplt[c]))
par(fg = cabar)
with(data = ms, expr = errbar(x,y,y+sd,y-sd,add=T,pch=16,cap=.01,col=caf))
# axis(side=2, labels=T, tck=0.03, las=1,mgp=c(3, 0.3,0), at=c(seq(from=0,to=400,by=50)))
par(fg = "black")
fit <- lm(y~ x)
summary(fit)$r.squared
pvalue <- summary(fit)$coefficients[2,4]
#-----  OLS  ----------------------------------------------------------------
x0 <- seq(min(x), max(x), length = 20)  ## prediction grid
y0 <- predict.lm(fit, newdata = list(x = x0))  ## predicted values
slp1=round(as.numeric(fit$coefficients[2]),digit=1)
if (pvalue<0.05){
lines(x0, y0, col = 'red',lwd=3)  ## add regression curve (colour: red)
mtext(paste('Slope = ',slp1,sep=''),outer=FALSE,side=3,line = -4.,col = "red",
at=par("usr")[1]+0.2*diff(par("usr")[1:2]),cex=rsize)
}
#-----  TLS   ---------------------------------------------------------------
v <- prcomp(cbind(x,y))$rotation
beta <- v[2,1]/v[1,1]
inter <- mean(y) - beta*mean(x)
x00 <- seq(min(x), max(x), length = 20)
y00 <- beta*x00+inter
if (pvalue<0.05){
lines(x00,y00,col="blue",lwd=2)
}
slp2 <- round(beta,digits = 2)
# saveslp <- cbind(saveslp,slp2)
#----------------------------------------------------------------------------
a=round(cor(x,y),digits = 2)
# b=round(RMSE(x,y),digits = 2)
mtext(paste('R = ',a,sep=''),outer=FALSE,side=1,line = -3.,col = "black",
at=par("usr")[1]+0.8*diff(par("usr")[1:2]),cex=rsize)
if ((pvalue<0.05) & (pvalue>0.01)){
mtext(paste('P < 0.05 ',sep=''),outer=FALSE,side=1,line = -2.,col = "black",
at=par("usr")[1]+0.8*diff(par("usr")[1:2]),cex=rsize)
mtext(paste('Slope = ',slp2,sep=''),outer=FALSE,side=3,line = -8.,col = "blue",
at=par("usr")[1]+0.2*diff(par("usr")[1:2]),cex=rsize)
}else if(pvalue<=0.01){
mtext(paste('P < 0.01',sep=''),outer=FALSE,side=1,line = -2.,col = "black",
at=par("usr")[1]+0.8*diff(par("usr")[1:2]),cex=rsize)
mtext(paste('Slope = ',slp2,sep=''),outer=FALSE,side=3,line = -8.,col = "blue",
at=par("usr")[1]+0.2*diff(par("usr")[1:2]),cex=rsize)
}
mtext(paste('(',c-1,')',sep=''),outer=FALSE,side=1,line = -5.,col = "black",
at=par("usr")[1]+0.9*diff(par("usr")[1:2]),cex=rsize)
}
dev.off()
# CO2.CH4=ann.er/ann.ch4
# Rh.ratio=ann.rh/ann.er
# oxipercentage=ann.oxid/ann.prod
# df <- rbind(CO2.CH4,Rh.ratio,ann.nee)
# print("save to csv file")
# # setwd("E:/Netbeans_Project/TECO_SPRUCE_2.2_acclimation_server/scripts_on_server/Rscript_on_server/ann/")
# setwd(paste(readpath,"ann/",sep=''))
# write.csv(df, file = paste("statistics/ann_yr_ratios",CS[1],".csv",sep=''))
